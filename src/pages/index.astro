---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../config";

const posts = (await Astro.glob("./posts/**/*.{md,mdx}")).sort(
	(a, b) =>
		new Date(b.frontmatter.pubDate).valueOf() -
		new Date(a.frontmatter.pubDate).valueOf()
);

const current_year = new Date().getFullYear();

function cleanCategory(string: string): string {
	string = string.charAt(0).toUpperCase() + string.slice(1); // Uc first
	string = string.replaceAll("-", " "); // Replace - par un espace
	return string;
}
---

<!DOCTYPE html>
<html lang="fr-fr">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<div id="app">
			<Header title={SITE_TITLE} />
			<main>
				<section class="articles">
					{
						posts.map((post) => (
							<div
								class={`article category--${post.frontmatter.category}`}
							>
								<a href={post.url} class="article__image">
									<img
										src={post.frontmatter.heroImage}
										alt={`Image du post "${post.frontmatter.title}"`}
									/>
								</a>
								<div class="article__top">
									<a href={post.url}>
										<time
											class="article__category"
											datetime={post.frontmatter.pubDate}
										>
											{new Date(
												post.frontmatter.pubDate
											).toLocaleDateString("fr-fr", {
												year:
													current_year ==
													new Date(
														post.frontmatter.pubDate
													).getFullYear()
														? undefined
														: "numeric",
												month: "long",
												day: "numeric",
											})}
										</time>
									</a>
									<a
										href={`category/${post.frontmatter.category}`}
										class="article__category"
									>
										{cleanCategory(
											post.frontmatter.category
										)}
									</a>
								</div>
								<a href={post.url}>
									<h3 class="article__title">
										{post.frontmatter.title}
									</h3>
								</a>
								<p class="article__description">
									{post.frontmatter.description}
								</p>
								<div class="article__bottom">
									<a href={post.url}>
										Lire la suite
										<span class="material-icons">
											chevron_right
										</span>
									</a>
								</div>
							</div>
						))
					}
				</section>
				<Footer />
			</main>
		</div>
	</body>
</html>
